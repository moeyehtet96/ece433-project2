clear all
clc

r = 0.1;
L = 5e-3;
I_desired = 10;
w_ac = 400*pi;
f_ac = 2*pi/w_ac;
T_ac = 1/f_ac;
f_sw = 1000*f_ac;
T_sw = 1/f_sw;
del_t = T_sw/100;

Vdc_min = sqrt(3)*sqrt(((r*I_desired)^2) + ((w_ac*L*I_desired)^2))
fprintf("Minimum Vdc is %4f.\n",Vdc_min)
Vdc = input("Input Vdc > Vdc_min:")

h = I_desired/100;

i_as(1) = 0;
i_bs(1) = 0;
i_cs(1) = 0;

T1(1) = 1;
T4(1) = 0;

T2(1) = 1;
T5(1) = 0;

T3(1) = 1;
T6(1) = 0;

t(1) = 0;
k = 1;


while t < t_end
    V_ag(k) = T1(k)*Vdc;
    V_bg(k) = T2(k)*Vdc;
    V_cg(k) = T3(k)*Vdc;
    
    V_as(k) = (2/3)*V_ag(k) - (1/3)*V_bg(k) - (1/3)*V_cg(k);
    V_bs(k) = (2/3)*V_bg(k) - (1/3)*V_ag(k) - (1/3)*V_cg(k);
    V_cs(k) = (2/3)*V_cg(k) - (1/3)*V_ag(k) - (1/3)*V_bg(k);
    
    i_as(k+1) = i_as(k) + del_t*(V_as(k) - r*i_as(k))/L;
    i_bs(k+1) = i_bs(k) + del_t*(V_bs(k) - r*i_bs(k))/L;
    i_cs(k+1) = i_cs(k) + del_t*(V_cs(k) - r*i_cs(k))/L;
    
    if i_as(k+1) > i_as(k+1) + h
        T4(k+1) = 1;
        T1(k+1) = 0;
    elseif i_as(k+1) < i_as(k+1) - h
        T4(k+1) = 0;
        T1(k+1) = 1;
    else
        T4(k+1) = T4(k);
        T1(k+1) = T1(k);
    end
    
    if i_bs(k+1) > i_bs(k+1) + h
        T5(k+1) = 1;
        T2(k+1) = 0;
    elseif i_bs(k+1) < i_bs(k+1) - h
        T5(k+1) = 0;
        T2(k+1) = 1;
        else
        T4(k+1) = T4(k);
        T1(k+1) = T1(k);
    end
    
    if i_cs(k+1) > i_cs(k+1) + h
        T6(k+1) = 1;
        T3(k+1) = 0;
    elseif i_cs(k+1) < i_cs(k+1) - h
        T6(k+1) = 0;
        T3(k+1) = 1;
    end
end

figure;
plot(t,V_as)

figure;
plot(t,i_as)
    
    

